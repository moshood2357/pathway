{% extends 'base.html' %}

{% block title %}Professionals{% endblock title %}

{% block style %}
{{ super() }}
<style>
    .professional-card {
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .professional-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .professional-name {
        font-weight: 600;
        color: #343a40;
    }

    .professional-info li {
        margin-bottom: 5px;
    }

    .professional-info a {
        text-decoration: none;
        color: #0d6efd;
    }

    .professional-info a:hover {
        text-decoration: underline;
    }

    .cards-wrapper {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }
</style>
{% endblock style %}

{% block content %}
<div class="container py-4">
    <h1 class="text-center mb-4">List of Professionals</h1>

    <!-- SEARCH INPUT -->
    <div class="mb-4">
        <input 
            type="text"
            id="professionalSearch"
            class="form-control"
            placeholder="Search professionals by name, email, LinkedIn, or career..."
        >
    </div>

    <!--  Professionals Container -->
    <div id="professionalContainer" class="cards-wrapper">
        {% for p in pro %}
        <div class="professional-card bg-white">
            <h3 class="professional-name mb-2">{{ p.first_name }} {{ p.last_name }}</h3>
            <ul class="professional-info list-unstyled mb-0">
                <li><strong>Email:</strong> {{ p.email }}</li>
                <li><strong>LinkedIn:</strong> 
                    {% if p.linkedin_id %}
                        <a href="{{ p.linkedin_id }}" target="_blank">{{ p.linkedin_id }}</a>
                    {% else %}
                        N/A
                    {% endif %}
                </li>
                <li><strong>Expertise:</strong> {{ p.career.career_name }}</li>
            </ul>
        </div>
        {% endfor %}
    </div>

    <!--  Hidden original list for resetting -->
    <div id="initialProfessionalCards" style="display: none;">
        {% for p in pro %}
        <div class="professional-card bg-white">
            <h3 class="professional-name mb-2">{{ p.first_name }} {{ p.last_name }}</h3>
            <ul class="professional-info list-unstyled mb-0">
                <li><strong>Email:</strong> {{ p.email }}</li>
                <li><strong>LinkedIn:</strong> 
                    {% if p.linkedin_id %}
                        <a href="{{ p.linkedin_id }}" target="_blank">{{ p.linkedin_id }}</a>
                    {% else %}
                        N/A
                    {% endif %}
                </li>
                <li><strong>Expertise:</strong> {{ p.career.career_name }}</li>
            </ul>
        </div>
        {% endfor %}
    </div>

</div>
{% endblock content %}

{% block js %}
{{ super() }}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function () {
    let debounceTimer;

    $("#professionalSearch").on("keyup", function () {
        clearTimeout(debounceTimer);
        let query = $(this).val().trim();

        debounceTimer = setTimeout(function () {
            const container = $("#professionalContainer");

            if (!query) {
                container.html($("#initialProfessionalCards").html());
                return;
            }

            $.ajax({
                url: "{{ url_for('views.search_professionals') }}",
                method: "GET",
                data: { q: query },
                dataType: "json",
                success: function(response) {
                    container.empty();

                    if (response.length === 0) {
                        container.append('<p class="text-muted">No professionals found.</p>');
                        return;
                    }

                    response.forEach(function(p) {
                        const card = `
                        <div class="professional-card bg-white">
                            <h3 class="professional-name mb-2">${p.first_name} ${p.last_name}</h3>
                            <ul class="professional-info list-unstyled mb-0">
                                <li><strong>Email:</strong> ${p.email}</li>
                                <li><strong>LinkedIn:</strong> 
                                    ${p.linkedin_id 
                                        ? `<a href="${p.linkedin_id}" target="_blank">${p.linkedin_id}</a>` 
                                        : 'N/A'
                                    }
                                </li>
                                <li><strong>Expertise:</strong> ${p.career}</li>
                            </ul>
                        </div>`;
                        container.append(card);
                    });
                },
                error: function() {
                    console.error("Search failed");
                }
            });

        }, 300);
    });
});
</script>
{% endblock js %}
